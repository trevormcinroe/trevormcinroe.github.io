<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Terra Nova Documentation</title>

<!-- Prism theme (dark) -->
<link rel="stylesheet" href="https://unpkg.com/prismjs/themes/prism-okaidia.css">
<!-- Prism core + Python component -->
<script src="https://unpkg.com/prismjs/prism.js"></script>
<script src="https://unpkg.com/prismjs/components/prism-python.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #2C363F 0%, #81ADC8 100%);
            min-height: 100vh;
            color: #2C363F;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
            line-height: 1.5;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: #F2F5EA;
            min-height: 100vh;
            box-shadow: 0 0 50px rgba(44, 54, 63, 0.3);
        }

        header {
            padding: 20px 40px;
            border-bottom: 3px solid #81ADC8;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(90deg, #F2F5EA 0%, rgba(129, 173, 200, 0.1) 100%);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            min-height: 80px;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: #2C363F;
            letter-spacing: -1px;
            position: relative;
            text-decoration: none;
            transition: color 0.2s ease;
        }

        .logo:hover {
            color: #81ADC8;
        }

        .logo::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #B68F40 0%, #BB4430 100%);
            border-radius: 2px;
        }

        nav {
            display: flex;
            gap: 35px;
        }

        nav a {
            text-decoration: none;
            color: #2C363F;
            font-weight: 600;
            padding: 8px 16px;
            border-radius: 0px;
            transition: all 0.2s ease;
        }

        nav a:hover {
            color: #F2F5EA;
            background: #81ADC8;
        }

        nav a.active {
            color: #F2F5EA;
            background: #B68F40;
        }

        .docs-container {
            padding: 40px;
            background: linear-gradient(135deg, #F2F5EA 0%, rgba(129, 173, 200, 0.05) 100%);
            min-height: calc(100vh - 80px);
        }

        .docs-header {
            margin-bottom: 40px;
            border-bottom: 2px solid rgba(129, 173, 200, 0.2);
            padding-bottom: 20px;
        }

        .docs-title {
            font-size: 3rem;
            font-weight: 900;
            background: linear-gradient(135deg, #2C363F 0%, #81ADC8 50%, #B68F40 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            -moz-background-clip: text;
            -moz-text-fill-color: transparent;
            margin-bottom: 15px;
            letter-spacing: -1px;
            display: inline-block;
        }

        .docs-subtitle {
            font-size: 1.2rem;
            color: rgba(44, 54, 63, 0.8);
            font-weight: 400;
        }

        .docs-layout {
            display: grid;
            grid-template-columns: 250px 1fr;
            gap: 40px;
            align-items: start;
        }

        .sidebar {
            background: linear-gradient(135deg, #F2F5EA 0%, rgba(129, 173, 200, 0.08) 100%);
            border-radius: 0px;
            padding: 25px;
            border: 1px solid rgba(129, 173, 200, 0.2);
            box-shadow: 0 5px 20px rgba(44, 54, 63, 0.1);
            position: sticky;
            top: 20px;
        }

        .sidebar h3 {
            color: #2C363F;
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 15px;
            padding-bottom: 8px;
            border-bottom: 2px solid #81ADC8;
        }

        .sidebar ul {
            list-style: none;
        }

        .sidebar li {
            margin-bottom: 8px;
        }

        .sidebar a {
            color: rgba(44, 54, 63, 0.8);
            text-decoration: none;
            font-weight: 500;
            padding: 6px 12px;
            border-radius: 0px;
            display: block;
            transition: all 0.2s ease;
        }

        .sidebar a:hover {
            background: rgba(129, 173, 200, 0.2);
            color: #2C363F;
        }

        .sidebar a.active {
            background: #81ADC8;
            color: #F2F5EA;
        }

        .main-content {
            background: #F2F5EA;
            border-radius: 0px;
            padding: 35px;
            border: 1px solid rgba(129, 173, 200, 0.2);
            box-shadow: 0 5px 20px rgba(44, 54, 63, 0.1);
        }

        .section {
            margin-bottom: 40px;
        }

        .section h2 {
            color: #2C363F;
            font-size: 1.8rem;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(182, 143, 64, 0.3);
        }

        .section h3 {
            color: #2C363F;
            font-size: 1.3rem;
            font-weight: 600;
            margin: 25px 0 15px 0;
        }

        .section p {
            color: rgba(44, 54, 63, 0.9);
            line-height: 1.7;
            margin-bottom: 15px;
        }

      .code-block {
          background: #2C363F;
          color: #F2F5EA;
          padding: 20px;
          border-left: 4px solid #81ADC8;
          font-family: 'Monaco','Menlo','Ubuntu Mono',monospace;
          font-size: 0.9rem;
          overflow-x: auto;
          margin: 20px 0;
          white-space: pre;
          tab-size: 4;
          font-variant-ligatures: none;
          border-radius: 0;
        }
        /* Let Prism’s tokens inherit your colors unless specified by theme */
        .code-block code { color: inherit; }

        .code-inline {
            background: #2C363F;
            color: #F2F5EA;
            padding: 2px 6px;
            border-radius: 0px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }

        .info-box {
            background: linear-gradient(135deg, rgba(129, 173, 200, 0.1) 0%, rgba(182, 143, 64, 0.1) 100%);
            border-left: 4px solid #81ADC8;
            padding: 20px;
            border-radius: 0px;
            margin: 25px 0;
        }

        .info-box.warning {
            border-left-color: #BB4430;
            background: linear-gradient(135deg, rgba(187, 68, 48, 0.1) 0%, rgba(182, 143, 64, 0.1) 100%);
        }

        .info-box h4 {
            color: #2C363F;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .parameter-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #F2F5EA;
            border-radius: 0px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(44, 54, 63, 0.1);
        }

        .parameter-table th {
            background: #81ADC8;
            color: #F2F5EA;
            padding: 15px;
            text-align: left;
            font-weight: 600;
        }

        .parameter-table td {
            padding: 12px 15px;
            border-bottom: 1px solid rgba(129, 173, 200, 0.2);
            color: rgba(44, 54, 63, 0.9);
        }

        .parameter-table tr:last-child td {
            border-bottom: none;
        }

        .parameter-table tr:nth-child(even) {
            background: rgba(129, 173, 200, 0.05);
        }

        @media (max-width: 768px) {
            header {
                padding: 15px 20px;
                flex-direction: column;
                gap: 20px;
            }

            nav {
                gap: 20px;
                flex-wrap: wrap;
                justify-content: center;
            }

            .docs-container {
                padding: 20px;
            }

            .docs-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .sidebar {
                position: static;
                order: 2;
            }

            .main-content {
                padding: 20px;
            }

            .docs-title {
                font-size: 2.5rem;
            }
        }

        /* Smooth page load animation */
        .container {
            animation: fadeIn 1s ease-out;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .text-block .ol-root{
          list-style-position: outside;
          margin-left: 1.25rem;   /* indent outer list */
          padding-left: 1.25rem;
        }

        .text-block .ol-root > li{ margin: 0.25rem 0; }

        .text-block .ol-root .ol-nested{
          margin-top: 0.25rem;
          margin-left: 1.5rem;    /* one level deeper */
          padding-left: 1.25rem;
        }

        /* ===== Terra Nova spec: manual / ledger (clean) ===== */
        :root{
          --ink:#2C363F; --paper:#F2F5EA; --sky:#81ADC8; --gold:#B68F40; --brick:#BB4430;
        }

        /* Manual headings */
        .manual h2, .manual h3, .manual h4{font-weight:800; letter-spacing:-.2px; color:var(--ink)}
        .manual h2{border-bottom:2px solid rgba(44,54,63,.18); padding-bottom:6px; margin-bottom:14px}
        .manual h3{margin-top:28px; border-left:4px solid var(--sky); padding-left:10px}
        .manual h4{margin-top:18px}

        /* Spec block */
        .spec-block{
          background: var(--paper);
          border:1px solid rgba(44,54,63,.18);
          box-shadow: inset 0 0 0 3px rgba(129,173,200,.06);
          font-family:'Monaco','Menlo','Ubuntu Mono',monospace;
          font-size:.92rem; line-height:1.5; padding:12px 14px; overflow:auto; margin:12px 0;
          color: var(--ink);
        }

        /* Ledger table */
        .ledger{
          width:100%; border-collapse:separate; border-spacing:0;
          background: var(--paper);
          border:1px solid rgba(44,54,63,.22);
        }
        .ledger td{
          padding:9px 12px; vertical-align:top; border-bottom:1px solid rgba(44,54,63,.12);
          color:rgba(44,54,63,.95);
        }
        .ledger tr:last-child td{ border-bottom:none; }

        /* Column sizing */
        .ledger col.col-field{width:20%}
        .ledger col.col-shape{width:32%}

        /* Header: darker, flat, no underline */
        .ledger thead th,
        .kv-table thead th,
        .parameter-table thead th{
          text-align:left; font-weight:900; letter-spacing:.15px; color:var(--ink);
          background: rgba(129,173,200,.22);
          border-bottom: 2px solid rgba(44,54,63,.28);
          padding:10px 12px;
        }
        /* Make sure any old underline is off */
        .ledger thead th::after,
        .kv-table thead th::after,
        .parameter-table thead th::after{ content:none !important; display:none !important; }

        /* Body: zebra + hover */
        .ledger tbody tr:nth-child(even),
        .kv-table tbody tr:nth-child(even),
        .parameter-table tbody tr:nth-child(even){ background: rgba(129,173,200,.08); }
        .ledger tbody tr:hover,
        .kv-table tbody tr:hover,
        .parameter-table tbody tr:hover{ background: rgba(129,173,200,.12); }

        /* Inline code chips */
        .ledger code, .kv-table code, .parameter-table code, .spec-block code{
          font-family:'Monaco','Menlo','Ubuntu Mono',monospace;
          background: rgba(129,173,200,.14);
          border: 1px solid rgba(129,173,200,.32);
          padding:2px 6px; border-radius:2px; color: var(--ink);
          white-space: nowrap;
        }

        /* Subsection label + rule */
        .subhead{ display:flex; align-items:center; gap:10px; margin-top:24px; margin-bottom:6px; }
        .subhead .num{
          font-weight:900; font-variant-numeric:tabular-nums; color:var(--paper);
          background:var(--ink); padding:2px 8px;
        }
        .subhead .rule{ flex:1; height:1px; background:linear-gradient(90deg, rgba(44,54,63,.25), rgba(44,54,63,0)); }

        /* Muted inline tag */
        .i-tag{
          display:inline-block; font-size:.75rem; font-weight:800; letter-spacing:.3px;
          padding:1px 6px; border:1px solid rgba(44,54,63,.2); color:var(--ink);
          background:rgba(44,54,63,.06); border-radius:999px; margin-left:6px;
        }

        /* Responsive ledger */
        @media (max-width:900px){
          .ledger col.col-field{width:26%}
          .ledger col.col-shape{width:40%}
        }
        @media (max-width:720px){
          .ledger thead{display:none}
          .ledger tr{display:block; padding:10px 12px; border-bottom:1px solid rgba(44,54,63,.12)}
          .ledger td{display:block; padding:4px 0; border:none}
          .ledger td::before{
            content:attr(data-label) ": ";
            font-weight:700; color:var(--ink); margin-right:6px;
          }
        }

        /* Optional: slightly darker page header bar */
        header{
          background: linear-gradient(90deg, #E9EDE4 0%, rgba(129,173,200,0.18) 100%) !important;
          border-bottom-color: rgba(44,54,63,0.28) !important;
        }
    </style>
    <script src="/terra_nova_header.js" defer></script>
    <link rel="stylesheet" href="/terra_nova_header.css">
</head>
<body>
    <div class="container">
      <div id="header-container"></div>

        <!--
        <header>
            <a href="civitas" class="logo">Terra Nova</a>
            <nav>
                <a href="#environment">Environment</a>
                <a href="#research">Research</a>
                <a href="#docs" class="active">Documentation</a>
                <a href="#contact">Contact</a>
            </nav>
        </header>
        -->

        <div class="docs-container">
            <div class="docs-header">
                <h1 class="docs-title">Environment Documentation</h1>
                <p class="docs-subtitle">Complete guide to the Terra Nova reinforcement learning environment</p>
            </div>

            <div class="docs-layout">
                <aside class="sidebar">
                    <h3>Contents</h3>
                    <ul>
                        <li><a href="#installation" class="active">Installation</a></li>
                        <li><a href="#quickstart">Quick Start</a></li>
                        <li><a href="#action-space">Action Space</a></li>
                        <li><a href="#executed-actions">Executed Actions</a></li>
                        <li><a href="#observation-space">Observation Space</a></li>
                        <li><a href="#mapgen">Generating Maps</a></li>
                        <li><a href="#recording">Recording Games</a></li>
                        <li><a href="#viewer">Viewing Games</a></li>
                    </ul>
                </aside>

                <main class="main-content">
                    <section id="installation" class="section">
                        <h2>Installation</h2>
                        <p>Install Terra Nova from the official repository:</p>

                        <div class="code-block">git clone https://github.com/trevormcinroe/terra_nova/</div>

                        <div class="info-box">
                            <h4>Requirements</h4>
                            <p>Terra Nova requires Python 3.9+, and has been tested on Linux with jax 4.30. GPU acceleration is optional but strongly recommended for training.</p>
                        </div>
                    </section>

                    <section id="quickstart" class="section">
                        <h2>Quick Start</h2>
                        <p>Get started with Terra Nova in just a few lines of code:</p>

                        <pre class="code-block"><code class="language-python">import argparse
import os
import pickle
import jax

from sim.build import build_simulator


parser = argparse.ArgumentParser()
parser.add_argument("--seed", type=int)
parser.add_argument("--num_steps", type=int, default=300)
parser.add_argument("--map_folder", type=str)
parser.add_argument("--distributed_strategy", type=str)
parser.add_argument("--memory_length", type=int, default=1)
args = parser.parse_args()

all_maps = os.listdir(args.map_folder)

games = []

for game in all_maps:
    if ".gamestate" not in game:
        continue
    with open(f"{args.map_folder}/{game}", "rb") as f:
        gamestate = pickle.load(f)
    games.append(gamestate)

(
  env_step_fn,
  games,
  obs_spaces,
  episode_metrics,
  players_turn_id,
  obs,
  GLOBAL_MESH,
  sharding
) = build_simulator(
    games,
    args.distributed_strategy,
    jax.random.PRNGKey(args.seed),
)

for game_step in range(args.num_steps):
    for agent_step in range(6):
        actions = ...
        (
          games,
          obs_spaces,
          episode_metrics,
          new_players_turn_id,
          next_obs,
          rewards,
          done_flags,
          selected_actions
        ) = env_step_fn(
            games, actions, obs_spaces, episode_metrics, players_turn_id
        )

        players_turn_id = new_players_turn_id
        obs = next_obs</code></pre>

                      <p>
                      For more detail, see the file <code class="code-inline">training_demo.py</code>.
                      </p>
                    </section>

                    <section id="action-space" class="section">
                      <h2>Action Space</h2>
                      <h3>Summary</h3>
                      <p>
                      Terra Nova's action space is made of several sub-action spaces that each control a different mechanic in the environment. Below is a high-level summary of the array shapes the environment expects to receive from each agent at each timestep. These actions should be given to the environment in the form of a nested tuple in the following order:
                      </p>

                      <div class="code-block">
action = Tuple[
  Tuple[jnp.ndarray, jnp.ndarray, jnp.ndarray, jnp.ndarray],  # tuple of four arrays
  jnp.ndarray,  # array
  jnp.ndarray,  # array
  jnp.ndarray,  # array
  Tuple[jnp.ndarray, jnp.ndarray],  # tuple of two arrays
  Tuple[jnp.ndarray, jnp.ndarray]  # tuple of two arrays
]
                      </div>

                      <p>
                      Below is further detail on the endpoint being controlled by each sub-action space. Each each given to the environment should have two leading axes. The first is the number of devices (e.g., GPUs) the simulator is distributed over (<code class="code-inline">num_devices</code>). The second is the number of parallel games per device (<code class="code-inline">num_games</code>).
                      </p>

                      <!-- 3.1 Trade Deals -->
                      <div class="subhead"><span class="num">1</span><h3 style="margin:0">Trade Deals</h3><div class="rule"></div></div>
                      <p>
                      These actions control the process through which agents may trade resources, embassies, etc. Only one trade deal can be offered per agent per turn.
                      </p>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead>
                          <tr><th>Field</th><th>Shape</th><th>Semantics</th></tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Accept/Deny</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 6, 2)</code></td>
                            <td data-label="Semantics">Binary {accept, deny} for each other agent's offer.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">Ask (per agent)</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 6, 56)</code></td>
                            <td data-label="Semantics">Distribution over 56 tradeables, represents what the agent would like to receive in the trade.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">Offer</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 56)</code></td>
                            <td data-label="Semantics">Distribution over 56 tradeables, represents what the given agent is offering.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">Counterparty</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 6)</code></td>
                            <td data-label="Semantics">Distribution over other agents. pairs with <em>Ask</em>/<em>Offer</em> to form a proposal.</td>
                          </tr>
                        </tbody>
                      </table>

                      <!-- 3.2 Social Policies -->
                      <div class="subhead"><span class="num">2</span><h3 style="margin:0">Social Policies</h3><div class="rule"></div></div>
                      <p>
                      The actions controlling social policy selection will only be executed if the agent has generated enough culture to allow for a new selection.
                      </p>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead>
                          <tr><th>Field</th><th>Shape</th><th>Semantics</th></tr>
                        </thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Policy</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 54)</code></td>
                            <td data-label="Semantics">Distribution over all social policies.</td>
                          </tr>
                        </tbody>
                      </table>

                      <!-- 3.3 Religion -->
                      <div class="subhead"><span class="num">3</span><h3 style="margin:0">Religion</h3><div class="rule"></div></div>
                      <p>
                      Similar to social policies, the actions controlling religious tenet selection will only be executed if the agent has generated enough faith to allow for a new selection.
                      </p>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead><tr><th>Field</th><th>Shape</th><th>Semantics</th></tr></thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Tenet</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 91)</code></td>
                            <td data-label="Semantics">Distribution over all religious tenets.</td>
                          </tr>
                        </tbody>
                      </table>

                      <!-- 3.4 Technology -->
                      <div class="subhead"><span class="num">4</span><h3 style="margin:0">Technology</h3><div class="rule"></div></div>
                      <table class="ledger">
                      <p>
                      Similar to religion, the actions controlling technology selection will only be executed if the agent has generated enough science to allow for a new selection. Once a technology has been selected, research towards that technology cannot be stopped.
                      </p>
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead><tr><th>Field</th><th>Shape</th><th>Semantics</th></tr></thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Tech</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 81)</code></td>
                            <td data-label="Semantics">Distribution over all technologies.</td>
                          </tr>
                        </tbody>
                      </table>

                      <!-- 3.5 Units -->
                      <div class="subhead"><span class="num">5</span><h3 style="margin:0">Units</h3><div class="rule"></div></div>
                      <p>
                      The actions for units control both the type of action and where on the map the selected action type should occur. A unit's type (e.g., worker versus trade caravan) determines which action categories are valid. The tiles upon which a given action category can be executed depends on how many action points a given unit type has, the action category itself, the map's terrain, and several other factors.
                      </p>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead><tr><th>Field</th><th>Shape</th><th>Semantics</th></tr></thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Action Type</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 30, 19)</code></td>
                            <td data-label="Semantics">19-category action distribution, independent per unit (30).</td>
                          </tr>
                          <tr>
                            <td data-label="Field">Target Hex</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 30, 2772)</code></td>
                            <td data-label="Semantics">Distribution over 42×66 hexes, independent per unit (30).</td>
                          </tr>
                        </tbody>
                      </table>

                      <!-- 3.6 Cities -->
                      <div class="subhead"><span class="num">6</span><h3 style="margin:0">Cities</h3><div class="rule"></div></div>
                      <p>
                      The actions for cities control what is being made in each city as well as which tiles are being worked within the owned tiles of each city. Once a construction target has been selected, the thing being constructed in each city cannot be changed.
                      </p>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead><tr><th>Field</th><th>Shape</th><th>Semantics</th></tr></thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Worked Tiles</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 10, 36, 36)</code></td>
                            <td data-label="Semantics">Citizen-to-tile assignment, independent per city (10)</td>
                          </tr>
                          <tr>
                            <td data-label="Field">Build Choice</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 10, 185)</code></td>
                            <td data-label="Semantics">Distribution over buildables (buildings & units), independent per city.</td>
                          </tr>
                        </tbody>
                      </table>


                      <h3>Detail</h3>
                      <p>
                      The actions in Terra Nova represent a <b>preference order</b> over outcomes. As several mechanics require sequential resolution, the most preferred outcome is not always a valid, executable action. For example, consider the following scenario:
                      </p>

                      <p>
                      A given agent has two cities and inputs a preference order over things to build in those two cities like:
                      </p>

                      <div class="text-block">
                        <ol class="ol-root">
                          <li> City 1
                            <ol class="ol-nested">
                              <li> Swordsman
                              <li> Great Library
                              <li> ...
                            </ol>

                          <li> City 2
                            <ol class="ol-nested">
                              <li> Great Library
                              <li> Worker
                              <li> ...
                            </ol>
                        </ol>
                      </div>

                      <p>
                      Swordsman require a connected iron resource to build, and the Great Library is a World Wonder (i.e., only one of a given agent's cities may attempt to build this at a time). If the agent has iron connected, City 1 will begin a swordsman and City 2 will begin the Great Library. However, if the agent does not have iron connected, City 1 will begin the Great Library and City 2 will begin a worker. It is due to the conditional and sequential nature of action resolution that the environment requires the full distribution over all possible actions for all controllable endpoints at each timestep.
                      </p>

                      <p>
                      Because the environment automatically handles masking and ultimately the selection of specific actions, the user will not know the exact actions that will be executed ahead of time (without an accurate world model). To help with training, the environment will return a summary of which index was ultimately selected for each of the sub-action categories.
                      </p>


                    </section>


                    <section id="executed-actions" class="section">
                      <h2>Executed Actions</h2>
                      <p>
                      As described in the previous step, agent must submit their actions over all endpoints as a preference order over all possible actions. To help with training, the environment will return the actions that were ultimately exectuted in the environment. The sub-action spaces will be in the same order on the way out as they are on the way in.
                      </p>

                      <p>
                      Similar to the observation space, when information is either missing or non-applicable, values will be <code>-1</code>. For example, if an agent has 10 of the maximum 30 units, selected-action information for the final 20 indices of unit-related arrays will be filled with <code>-1</code>.
                      </p>

                      <div class="subhead"><span class="num">1</span><h3 style="margin:0">Trade Deals</h3><div class="rule"></div></div>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead><tr><th>Field</th><th>Shape</th><th>Semantics</th></tr></thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Accept/Deny</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 6)</code></td>
                            <td data-label="Semantics">Binary {accept, deny} for each other agent's offer.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">Ask</td>
                            <td data-label="Shape"><code>(num_devices, num_games)</code></td>
                            <td data-label="Semantics">Integer corresponding to trade deal ask.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">Offer</td>
                            <td data-label="Shape"><code>(num_devices, num_games)</code></td>
                            <td data-label="Semantics">Integer corresponding to trade deal offer.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">Counterparty</td>
                            <td data-label="Shape"><code>(num_devices, num_games)</code></td>
                            <td data-label="Semantics">Integer corresponding to trade deal counterpary.</td>
                          </tr>
                        </tbody>
                      </table>


                      <div class="subhead"><span class="num">2</span><h3 style="margin:0">Social Policies</h3><div class="rule"></div></div>
                      <p>
                      Certain actions in the game grant an agent a free social policy on occasion. Each game returns a vector of integers of shape (2,) representing the (non-free, free) selections, respectively.
                      </p>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead><tr><th>Field</th><th>Shape</th><th>Semantics</th></tr></thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Policy</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 2)</code></td>
                            <td data-label="Semantics">Integers corresponding to social poicies selected (non-free, free).</td>
                          </tr>
                        </tbody>
                      </table>


                      <div class="subhead"><span class="num">3</span><h3 style="margin:0">Religion</h3><div class="rule"></div></div>
                      <p>
                      When founding a religion, agents must select three tenets at once. To accomidate for this information, all turns will return a vector of integers of shape (3,). During religion founding, the indices correspond to Founder tenet, Follower tenet, Follower tenet. When other types of tenets are selected, only the first element will correspond to a tenet integer.
                      </p>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead><tr><th>Field</th><th>Shape</th><th>Semantics</th></tr></thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Policy</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 3)</code></td>
                            <td data-label="Semantics">Integers corresponding to religions tenets selected.</td>
                          </tr>
                        </tbody>
                      </table>


                      <div class="subhead"><span class="num">4</span><h3 style="margin:0">Technology</h3><div class="rule"></div></div>
                      <p>
                      Certain actions in the game grant an agent a free technologies on occasion. Each game returns a vector of integers of shape (2,) representing the (non-free, free) selections, respectively.
                      </p>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead><tr><th>Field</th><th>Shape</th><th>Semantics</th></tr></thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Tech</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 2)</code></td>
                            <td data-label="Semantics">Integers corresponding to technologies selected (non-free, free).</td>
                          </tr>
                        </tbody>
                      </table>

                      <div class="subhead"><span class="num">5</span><h3 style="margin:0">Units</h3><div class="rule"></div></div>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead><tr><th>Field</th><th>Shape</th><th>Semantics</th></tr></thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Action Type</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 30)</code></td>
                            <td data-label="Semantics">Integers corresponding to the action-categories selected.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">Target Hex</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 30)</code></td>
                            <td data-label="Semantics">Integers corresponding to the map's hex-tiles selected.</td>
                          </tr>
                        </tbody>
                      </table>


                      <div class="subhead"><span class="num">6</span><h3 style="margin:0">Cities</h3><div class="rule"></div></div>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead><tr><th>Field</th><th>Shape</th><th>Semantics</th></tr></thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">Worked Tiles</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 10, 36)</code></td>
                            <td data-label="Semantics">Integers corresponding to the tiles selected to be worked.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">Build Choice</td>
                            <td data-label="Shape"><code>(num_devices, num_games, 10)</code></td>
                            <td data-label="Semantics">Integers corresponding to the buildings/units selected to be constructed.</td>
                          </tr>
                        </tbody>
                      </table>
                    </section>

                    <section id="observation-space" class="section">
                      <h2>Observation Space</h2>
                      <p>
                      The observation space in Terra Nova is large, but organized and hierarchical. Some components are in the shape of the map (i.e., a <code class="code-inline">(..., 42, 66, ...)</code>) array, some are continuous vectors, and some are scalars. The information also spans numerical type: some are continuous values and some are non-ordinal integers. Here we first describe the entire layout of a Terra Nova observation (along with the data shapes). Then we detail the contents of each item in an observation.
                      </p>

                      <div class="subhead"><span class="num">1</span><h3 style="margin:0">Main Observation</h3><div class="rule"></div></div>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead>
                          <tr><th>Field</th><th>Shape</th><th>Semantics</th></tr>
                        </thead>
                        <tbody>
                          <tr><td data-label="Field">elevation_map</td><td data-label="Shape"><code>(42, 66)</code></td><td data-label="Semantics">Describes the elevation level of each tile. Takes values in [0, 1, 2, 3], representing ocean, flatland, hill, and mountain, respectively.</td></tr>
                          <tr><td data-label="Field">terrain_map</td><td data-label="Shape"><code>(42, 66)</code></td><td data-label="Semantics">Describes the terrain type of each tile. Takes values in [0, 1, 2, 3, 4, 5] representing ocean, grassland, plains, desert, tundra, and snow, respectively.</td></tr>
                          <tr><td data-label="Field">edge_river_map</td><td data-label="Shape"><code>(42, 66, 6)</code></td><td data-label="Semantics">Describes whether a river is on the edge of each tile. Takes values in [0, 1].</td></tr>
                          <tr><td data-label="Field">lake_map</td><td data-label="Shape"><code>(42, 66)</code></td><td data-label="Semantics">Describes whether a lake exists on each tile. Takes values in [0, 1].</td></tr>
                          <tr><td data-label="Field">feature_map</td><td data-label="Shape"><code>(42, 66)</code></td><td data-label="Semantics">Describes the feature on each tile. Takes values in [0, 1, 2, 3, 4, 5, 6] representing none, forest, jungle, marsh, oasis, floodplains, and ice, respectively.</td></tr>
                          <tr><td data-label="Field">nw_map</td><td data-label="Shape"><code>(42, 66)</code></td><td data-label="Semantics">Describes the presence of Natural Wonders in each tile. Takes values in [0...17], where 0 indicates no Natural Wonder and the remaining integers represent one of the Natural Wonders.</td></tr>
                          <tr><td data-label="Field">cs_ownership_map</td><td data-label="Shape"><code>(42, 66)</code></td><td data-label="Semantics">Describes which city state owns each tile. Takes values in [0...12], where 0 indicates no ownership and the remaining integers represent ownership by one of the city states.</td></tr>

                          <tr><td data-label="Field">units</td><td data-label="Shape"><code>...</code></td><td data-label="Semantics">See "Units Observation".</td></tr>

                          <tr><td data-label="Field">technologies</td><td data-label="Shape"><code>(81)</code></td><td data-label="Semantics">Describes the technologies researched as a boolean 1/0.</td></tr>
                          <tr><td data-label="Field">policies</td><td data-label="Shape"><code>(54)</code></td><td data-label="Semantics">Describes the social policies selected as a boolean 1/0.</td></tr>

                          <tr><td data-label="Field">player_cities</td><td data-label="Shape"><code>...</code></td><td data-label="Semantics">See "Player Cities Observation".</td></tr>

                          <tr><td data-label="Field">yield_map_players</td><td data-label="Shape"><code>(42, 66, 7)</code></td><td data-label="Semantics">Describes the yields given by the map's tiles.</td></tr>
                          <tr><td data-label="Field">visible_resources_map_players</td><td data-label="Shape"><code>(42, 66)</code></td><td data-label="Semantics">Describes the resources the agent can see with its current technology.</td></tr>

                          <tr><td data-label="Field">science_reserves</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">Describes the built up science, empire-wide. This science is put towards completing research.</td></tr>
                          <tr><td data-label="Field">culture_reserves</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">Describes the built up culture, empire-wide. This culture is put towards selecting social policies.</td></tr>
                          <tr><td data-label="Field">faith_reserves</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">Describes the built up faith, empire-wide. This faith is put towards selecting religious tenets and purchasing religious buildings.</td></tr>

                          <tr><td data-label="Field">is_researching</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">Describes the technology being researched currently as a categorical integer.</td></tr>
                          <tr><td data-label="Field">num_trade_routes</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The maximum number of trade caravans the agent can maintain currently.</td></tr>

                          <tr><td data-label="Field">cs_perturn_influence</td><td data-label="Shape"><code>(12)</code></td><td data-label="Semantics">Describes the amount of influence the agent is exerting over each city state.</td></tr>

                          <tr><td data-label="Field">num_delegates</td><td data-label="Shape"><code>(6)</code></td><td data-label="Semantics">Describes the number of World Congress delegates from each agent.</td></tr>

                          <tr><td data-label="Field">culture_threshold</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">Describes the amount of culture build up required to unlock the next social policy.</td></tr>

                          <tr><td data-label="Field">religious_tenets</td><td data-label="Shape"><code>(6, 91)</code></td><td data-label="Semantics">Describes the religious tenets belonging to each agent's religion.</td></tr>

                          <tr><td data-label="Field">free_techs</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">Describes the number of technologies the agent can select for free on this turn. Only one free technology may be selected per turn.</td></tr>
                          <tr><td data-label="Field">free_policies</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">Describes the number of social policies the agent can select for free on this turn. Only one free policy may be selected per turn.</td></tr>

                          <tr><td data-label="Field">great_works</td><td data-label="Shape"><code>(4)</code></td><td data-label="Semantics">Describes the number of Great Works an agent has.</td></tr>

                          <tr><td data-label="Field">culture_info</td><td data-label="Shape"><code>...</code></td><td data-label="Semantics">See "Culture Observation"</td></tr>

                          <tr><td data-label="Field">improvement_additional_yield_map</td><td data-label="Shape"><code>(42, 66, 7)</code></td><td data-label="Semantics">Describes the yields from tile improvements in addition to the yields from the base map.</td></tr>
                          <tr><td data-label="Field">improvement_map</td><td data-label="Shape"><code>(42, 66)</code></td><td data-label="Semantics">Describes the improvements on the map tiles.</td></tr>
                          <tr><td data-label="Field">road_map</td><td data-label="Shape"><code>(42, 66)</code></td><td data-label="Semantics">Describes the presence of roads on the map tiles.</td></tr>

                          <tr><td data-label="Field">gpps</td><td data-label="Shape"><code>(6)</code></td><td data-label="Semantics">Describes the number of great person points toward each great person type, empire-wide.</td></tr>
                          <tr><td data-label="Field">gp_threshold</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">Describes the number of great person points required to generate a new great person.</td></tr>

                          <tr><td data-label="Field">golden_age_turns</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">Describes the number of turns remaining in the current golden age.</td></tr>

                          <tr><td data-label="Field">tourism_total</td><td data-label="Shape"><code>(6, 6)</code></td><td data-label="Semantics">Describes the amount of tourism generated by each agent onto each agent.</td></tr>
                          <tr><td data-label="Field">culture_total</td><td data-label="Shape"><code>(6,)</code></td><td data-label="Semantics">Describes the cumulative amout of culture generated.</td></tr>

                          <tr><td data-label="Field">citystate_info</td><td data-label="Shape"><code>...</code></td><td data-label="Semantics">See "City State Observation."</td></tr>

                          <tr><td data-label="Field">visibility_map</td><td data-label="Shape"><code>(42, 66)</code></td><td data-label="Semantics">Describes the visibility status of the map tiles. Takes values in [0, 1, 2] representing not ever seen, seen before but not currently, and currently see, respectively.</td></tr>

                          <tr><td data-label="Field">trade_offers</td><td data-label="Shape"><code>(6, 2)</code></td><td data-label="Semantics">Describes the incoming trade offers from each agent in an ask/offer format.</td></tr>
                          <tr><td data-label="Field">trade_ledger</td><td data-label="Shape"><code>(6, 10, 2)</code></td><td data-label="Semantics">Describes the currently-active trade deals with each other agent.</td></tr>
                          <tr><td data-label="Field">trade_length_ledger</td><td data-label="Shape"><code>(10)</code></td><td data-label="Semantics">Describes the turns remaining for each active trade deal.</td></tr>
                          <tr><td data-label="Field">trade_gpt_adjustment</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The net gold per turn adjustment due to trade deals.</td></tr>
                          <tr><td data-label="Field">trade_resource_adjustment</td><td data-label="Shape"><code>(52)</code></td><td data-label="Semantics">The net resource adjustment due to trade deals.</td></tr>

                          <tr><td data-label="Field">have_met</td><td data-label="Shape"><code>(16)</code></td><td data-label="Semantics">Describes whether the agent has met other agents and city states.</td></tr>
                          <tr><td data-label="Field">at_war</td><td data-label="Shape"><code>(6, 6)</code></td><td data-label="Semantics">Describes the war status between each pair of agents.</td></tr>
                          <tr><td data-label="Field">has_sacked</td><td data-label="Shape"><code>(6, 6)</code></td><td data-label="Semantics">Describes whether a given agent has sacked another agent's capital.</td></tr>

                          <tr><td data-label="Field">treasury</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">Describes how much gold the agent has built up.</td></tr>
                          <tr><td data-label="Field">happiness</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">Describes how happiness an agent has, empire-wide.</td></tr>

                          <!-- Derived Information -->
                          <tr><td data-label="Field">most_population</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the most population.</td></tr>
                          <tr><td data-label="Field">least_population</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the least population.</td></tr>

                          <tr><td data-label="Field">most_crop_yield</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the most food produced.</td></tr>
                          <tr><td data-label="Field">least_crop_yield</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the least food produced.</td></tr>

                          <tr><td data-label="Field">most_manufactured_goods</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the most production.</td></tr>
                          <tr><td data-label="Field">least_manufactured_goods</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the least production.</td></tr>

                          <tr><td data-label="Field">most_gnp</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the most gold per turn.</td></tr>
                          <tr><td data-label="Field">least_gnp</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the least gold per turn.</td></tr>

                          <tr><td data-label="Field">most_land</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the most land.</td></tr>
                          <tr><td data-label="Field">least_land</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the least land.</td></tr>

                          <tr><td data-label="Field">most_soldiers</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the most miilaty.</td></tr>
                          <tr><td data-label="Field">least_soldiers</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the least military.</td></tr>

                          <tr><td data-label="Field">most_approval</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the most happiness.</td></tr>
                          <tr><td data-label="Field">least_approval</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the least happiness.</td></tr>

                          <tr><td data-label="Field">most_literacy</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the most technology researched.</td></tr>
                          <tr><td data-label="Field">least_literacy</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer of the agent with the least technology researched.</td></tr>

                          <tr><td data-label="Field">player_id</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The integer relating to the agent's id.</td></tr>
                          <tr><td data-label="Field">current_turn</td><td data-label="Shape"><code>()</code></td><td data-label="Semantics">The turn number.</td></tr>
                        </tbody>
                      </table>




                      <div class="subhead"><span class="num">2</span><h3 style="margin:0">Units Observation</h3><div class="rule"></div></div>
                      <p>
                      All fields that begin with 6 (the number of players) are revealed on a full-visibility basis only. That is, when a given player can see another player's units, the information about that unit is revealed. Likewise, when the seen units dieappear from full visibility, that information is removed from the observation.
                      </p>
                      <table class="ledger">
                        <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
                        <thead><tr><th>Field</th><th>Shape</th><th>Semantics</th></tr></thead>
                        <tbody>
                          <tr>
                            <td data-label="Field">unit_type</td>
                            <td data-label="Shape"><code>(6, 30)</code></td>
                            <td data-label="Semantics">Describes the type of unit (e.g., worker versus settler). Takes values in [0...37], where 0 indicates no unit and the remaining integers represent one of the unit types.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">unit_rowcol</td>
                            <td data-label="Shape"><code>(6, 30, 2)</code></td>
                            <td data-label="Semantics">Describes the (row, col) location of units. Takes values in [0...65].</td>
                          </tr>
                          <tr>
                            <td data-label="Field">unit_ap</td>
                            <td data-label="Shape"><code>(6, 30)</code></td>
                            <td data-label="Semantics">Describes the action points of a unit, which determines how far a unit can move.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">engaged_for_n_turns</td>
                            <td data-label="Shape"><code>(30)</code></td>
                            <td data-label="Semantics">Describes for how may turns a unit is engaged in an action.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">engaged_action_id</td>
                            <td data-label="Shape"><code>(30)</code></td>
                            <td data-label="Semantics">Describes the action category the unit is currently engaged in.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">trade_to_player_int</td>
                            <td data-label="Shape"><code>(30)</code></td>
                            <td data-label="Semantics">If the unit is a caravan and is engaged in a traderoute, describes to which player the caravan is sent.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">trade_to_city_int</td>
                            <td data-label="Shape"><code>(30)</code></td>
                            <td data-label="Semantics">If the unit is a caravan and is engaged in a traderoute, describes to which city the caravan is sent.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">trade_from_city_int</td>
                            <td data-label="Shape"><code>(30)</code></td>
                            <td data-label="Semantics">If the unit is a caravan and is engaged in a traderoute, describes from which city the caravan is sent.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">trade_yields</td>
                            <td data-label="Shape"><code>(30, 2, 10)</code></td>
                            <td data-label="Semantics">If the unit is a caravan and is engaged in a traderoute, describes the yields produced by that trade route in a from/to format.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">combat_bonus_accel</td>
                            <td data-label="Shape"><code>(6, 30)</code></td>
                            <td data-label="Semantics">Describes the bonus the unit receives to its combat strength when attacked or attacking.</td>
                          </tr>
                          <tr>
                            <td data-label="Field">health</td>
                            <td data-label="Shape"><code>(6, 30)</code></td>
                            <td data-label="Semantics">Describes the current health of the unit.</td>
                          </tr>
                        </tbody>
                      </table>

                      <div class="subhead"><span class="num">3</span><h3 style="margin:0">Culture Observation</h3><div class="rule"></div></div>
<table class="ledger">
  <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
  <thead>
    <tr><th>Field</th><th>Shape</th><th>Semantics</th></tr>
  </thead>
  <tbody>
    <tr>
      <td data-label="Field">building_yields</td>
      <td data-label="Shape"><code>(10, 8)</code></td>
      <td data-label="Semantics">Describes the additional yields from buildings due to the agent's social policies.</td>
    </tr>
    <tr>
      <td data-label="Field">yields_per_kill</td>
      <td data-label="Shape"><code>(8)</code></td>
      <td data-label="Semantics">Describes the yields an agent generates for each unit killed.</td>
    </tr>
    <tr>
      <td data-label="Field">honor_finisher_yields_per_kill</td>
      <td data-label="Shape"><code>(8)</code></td>
      <td data-label="Semantics">Describes the yields an agent generates for each unit killed due to having completed the Honor social policy tree.</td>
    </tr>
    <tr>
      <td data-label="Field">cs_resting_influence</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the minimum influence value an agent has over all city states.</td>
    </tr>
    <tr>
      <td data-label="Field">cs_trade_route_yields</td>
      <td data-label="Shape"><code>(10, 2, 10)</code></td>
      <td data-label="Semantics">Describes the additional yields from a trade route sent from each city to a city state in the order [food, production, gold, faith, culture, science, happiness, tourism, religious pressure, influence.]</td>
    </tr>
    <tr>
      <td data-label="Field">additional_yield_map</td>
      <td data-label="Shape"><code>(42, 66, 7)</code></td>
      <td data-label="Semantics">Describes the yields due to social policies in addition to the yields from the base map.</td>
    </tr>
  </tbody>
</table>



                      <div class="subhead"><span class="num">4</span><h3 style="margin:0">City State Observation</h3><div class="rule"></div></div>
<table class="ledger">
  <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
  <thead>
    <tr><th>Field</th><th>Shape</th><th>Semantics</th></tr>
  </thead>
  <tbody>
    <tr>
      <td data-label="Field">religious_population</td>
      <td data-label="Shape"><code>(12, 6)</code></td>
      <td data-label="Semantics">The population count following each religion in the game for each city state.</td>
    </tr>
    <tr>
      <td data-label="Field">relationships</td>
      <td data-label="Shape"><code>(12)</code></td>
      <td data-label="Semantics">Describes the agent integer of each city state's ally.</td>
    </tr>
    <tr>
      <td data-label="Field">influence_level</td>
      <td data-label="Shape"><code>(12)</code></td>
      <td data-label="Semantics">Describes the agent's influence level over each city state.</td>
    </tr>
    <tr>
      <td data-label="Field">cs_type</td>
      <td data-label="Shape"><code>(12,)</code></td>
      <td data-label="Semantics">Describes the type of city state.</td>
    </tr>
    <tr>
      <td data-label="Field">quest_type</td>
      <td data-label="Shape"><code>(12)</code></td>
      <td data-label="Semantics">Describes the active quest for each city state.</td>
    </tr>
    <tr>
      <td data-label="Field">culture_tracker_mine</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the amount of culture generated towards culture quests.</td>
    </tr>
    <tr>
      <td data-label="Field">faith_tracker_mine</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the amount of faith generated towards faith quests.</td>
    </tr>
    <tr>
      <td data-label="Field">tech_tracker_mine</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the number of technologies researched towards technology quests.</td>
    </tr>
    <tr>
      <td data-label="Field">trade_tracker_mine</td>
      <td data-label="Shape"><code>(12)</code></td>
      <td data-label="Semantics">Describes the total number of turns put towards trade routes for trade route quests.</td>
    </tr>
    <tr>
      <td data-label="Field">religion_tracker_mine</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the number of turns the agent's religion has spent as the majority population in a city state towards religion quests.</td>
    </tr>
    <tr>
      <td data-label="Field">wonder_tracker_mine</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the number of wonders per turn the agent has built towards wonder quests.</td>
    </tr>
    <tr>
      <td data-label="Field">resource_tracker_mine</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the number of resources the agent has improved towards resource quests.</td>
    </tr>
    <tr>
      <td data-label="Field">culture_tracker_lead</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the value for the leader in culture quests.</td>
    </tr>
    <tr>
      <td data-label="Field">faith_tracker_lead</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the value for the leader in faith quests.</td>
    </tr>
    <tr>
      <td data-label="Field">tech_tracker_lead</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the value for the leader in technology quests.</td>
    </tr>
    <tr>
      <td data-label="Field">trade_tracker_lead</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the value for the leader in trade route quests.</td>
    </tr>
    <tr>
      <td data-label="Field">religion_tracker_lead</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the value for the leader in religion quests.</td>
    </tr>
    <tr>
      <td data-label="Field">wonder_tracker_lead</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the value for the leader in wonder quests.</td>
    </tr>
    <tr>
      <td data-label="Field">resource_tracker_lead</td>
      <td data-label="Shape"><code>()</code></td>
      <td data-label="Semantics">Describes the value for the leader in resource quests.</td>
    </tr>
    <tr>
      <td data-label="Field">city_rowcols</td>
      <td data-label="Shape"><code>(12, 2)</code></td>
      <td data-label="Semantics">Desribes the (row, col) location of city states.</td>
    </tr>
  </tbody>
</table>


                      <div class="subhead"><span class="num">5</span><h3 style="margin:0">Player Cities Observation</h3><div class="rule"></div></div>
                      <p>
                      Fields beginning with 6 (the number of agents in the game), are discoverable by all agents in the game.
                      </p>
<table class="ledger">
  <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
  <thead>
    <tr><th>Field</th><th>Shape</th><th>Semantics</th></tr>
  </thead>
  <tbody>
    <tr><td data-label="Field">city_ids</td><td data-label="Shape"><code>(6, 10)</code></td><td data-label="Semantics">Describes the type of city. Takes values in [0, 1, 2] where 0 is no city, 1 is a capital city, and 2 is a non-capital city.</td></tr>
    <tr><td data-label="Field">city_rowcols</td><td data-label="Shape"><code>(6, 10, 2)</code></td><td data-label="Semantics">Describes the (row, col) position of cities. Takes values in [0...65].</td></tr>
    <tr><td data-label="Field">ownership_map</td><td data-label="Shape"><code>(6, 10, 42, 66)</code></td><td data-label="Semantics">Describes the ownership status of each tile on a per-player, player-city basis. Takes values in [0, 1, 2, 3] representing not owned, could own, does own, and city center, respectively.</td></tr>
    <tr><td data-label="Field">yields</td><td data-label="Shape"><code>(10, 7)</code></td><td data-label="Semantics">Describes the yields for each city in the order [food, production, gold, faith, culture, science, happiness].</td></tr>
    <tr><td data-label="Field">city_center_yields</td><td data-label="Shape"><code>(10, 7)</code></td><td data-label="Semantics">Describes the yields for each city center in the order [food, production, gold, faith, culture, science, happiness].</td></tr>
    <tr><td data-label="Field">building_yields</td><td data-label="Shape"><code>(10, 8)</code></td><td data-label="Semantics">Describes the yields in total for each building per city in the order [food, production, gold, faith, culture, science, happiness, tourism].</td></tr>
    <tr><td data-label="Field">population</td><td data-label="Shape"><code>(6, 10)</code></td><td data-label="Semantics">Describes the population of each city.</td></tr>
    <tr><td data-label="Field">worked_slots</td><td data-label="Shape"><code>(10, 36)</code></td><td data-label="Semantics">Describes whether or not a tile is being worked in a city. Takes values in [0, 1].</td></tr>
    <tr><td data-label="Field">specialist_slots</td><td data-label="Shape"><code>(10, 6)</code></td><td data-label="Semantics">Describes how many specialists are in each city in the order [artist, musician, writer, engineer, merchant, scientist].</td></tr>
    <tr><td data-label="Field">gw_slots</td><td data-label="Shape"><code>(10, 5)</code></td><td data-label="Semantics">Describes the number of Great Works in each city in the order [writing, art, music, artifact].</td></tr>
    <tr><td data-label="Field">food_reserves</td><td data-label="Shape"><code>(10)</code></td><td data-label="Semantics">Describes the amount of excess food each city has. This excess goes towards population growth.</td></tr>
    <tr><td data-label="Field">growth_carryover</td><td data-label="Shape"><code>(10)</code></td><td data-label="Semantics">Describes the percent of excess food carried over as reserves when a city grows.</td></tr>
    <tr><td data-label="Field">prod_reserves</td><td data-label="Shape"><code>(10)</code></td><td data-label="Semantics">Describes the amount of built up production a city has. This reserve goes towards construction.</td></tr>
    <tr><td data-label="Field">prod_carryover</td><td data-label="Shape"><code>(10)</code></td><td data-label="Semantics">Describes the percent of excess built up production carried over after a city completes construction.</td></tr>
    <tr><td data-label="Field">is_constructing</td><td data-label="Shape"><code>(10)</code></td><td data-label="Semantics">Describes the object the city is constructing as a categorical integer.</td></tr>
    <tr><td data-label="Field">bldg_maintenance</td><td data-label="Shape"><code>(10)</code></td><td data-label="Semantics">Describes the amount of gold per turn each city is paying to maintain its buildings.</td></tr>
    <tr><td data-label="Field">defense</td><td data-label="Shape"><code>(6, 10)</code></td><td data-label="Semantics">Describes the defensive prowess of each city.</td></tr>
    <tr><td data-label="Field">hp</td><td data-label="Shape"><code>(6, 10)</code></td><td data-label="Semantics">Describes the current health of each city.</td></tr>
    <tr><td data-label="Field">buildings_owned</td><td data-label="Shape"><code>(10, 148)</code></td><td data-label="Semantics">Describes the buildings each city owns. Takes values in [0, 1].</td></tr>
    <tr><td data-label="Field">resources_owned</td><td data-label="Shape"><code>(10, 52)</code></td><td data-label="Semantics">Describes the resources connected to each city. Takes values in [0, 1].</td></tr>
    <tr><td data-label="Field">additional_yield_map</td><td data-label="Shape"><code>(42, 66, 7)</code></td><td data-label="Semantics">Describes the yields provided by buildings in a city additional to the yields from the base map.</td></tr>
    <tr><td data-label="Field">is_coastal</td><td data-label="Shape"><code>(6, 10)</code></td><td data-label="Semantics">Decribes whether a city is on the map coast. Takes values in [0, 1].</td></tr>
    <tr><td data-label="Field">religion_info</td><td data-label="Shape"><code>...</code></td><td data-label="Semantics">See "Religion Observation".</td></tr>
    <tr><td data-label="Field">culture_reserves_for_border</td><td data-label="Shape"><code>(10)</code></td><td data-label="Semantics">Describes the culture build up that will be spent on expanding a city's border.</td></tr>
    <tr><td data-label="Field">great_person_points</td><td data-label="Shape"><code>(10, 6)</code></td><td data-label="Semantics">Describes the build up of great person points per city in the order [artist, musician, writer, engineer, merchant, scientist].</td></tr>
  </tbody>
</table>


                    <div class="subhead"><span class="num">6</span><h3 style="margin:0">Religion Observation</h3><div class="rule"></div></div>

<table class="ledger">
  <colgroup><col class="col-field"><col class="col-shape"><col></colgroup>
  <thead>
    <tr><th>Field</th><th>Shape</th><th>Semantics</th></tr>
  </thead>
  <tbody>
    <tr>
      <td data-label="Field">religious_population</td>
      <td data-label="Shape"><code>(10, 6)</code></td>
      <td data-label="Semantics">Describes the population count that follows each religion in each city.</td>
    </tr>
    <tr>
      <td data-label="Field">religious_tenets_per_city</td>
      <td data-label="Shape"><code>(10, 91)</code></td>
      <td data-label="Semantics">Describes the religious tenets being applied to each city. This is determined by the religion with the majority population. Takes values in [0, 1].</td>
    </tr>
    <tr>
      <td data-label="Field">building_yields</td>
      <td data-label="Shape"><code>(10, 8)</code></td>
      <td data-label="Semantics">Describes the extra yields the buildings in each coty produces due to religion.</td>
    </tr>
    <tr>
      <td data-label="Field">additional_yield_map</td>
      <td data-label="Shape"><code>(10, 42, 66, 7)</code></td>
      <td data-label="Semantics">Describes the yields provided by religion in a city additional to the yields from the base map.</td>
    </tr>
    <tr>
      <td data-label="Field">cs_perturn_influence_cumulative</td>
      <td data-label="Shape"><code>(10, 12)</code></td>
      <td data-label="Semantics">Describes the cumulative religious pressure applied from each city onto each city state.</td>
    </tr>
    <tr>
      <td data-label="Field">player_perturn_influence_cumulative</td>
      <td data-label="Shape"><code>(10, 6, 10)</code></td>
      <td data-label="Semantics">Describes the cumulative religious pressure applied from ech city onto each other player's cities.</td>
    </tr>
  </tbody>
</table>





                    <section id="mapgen" class="section">
                        <h2>Generating Maps</h2>
                        <p>Terra Nova comes with 10k+ maps by default. We also provide a map-generation utility for users interested in larger training and/or evaluation runs. The map generation process is driven by jax's PRNG system, allowing for full determinism. To generate more maps, run the following:
                        </p>

                        <div class="code-block">
CUDA_VISIBLE_DEVICES= python3 generate_maps.py --start_seed 1 --num_maps 10
                        </div>

                        <p>
                        We recommend the user runs map generation on the CPU for speed considerations. One way to accomplish this is with the preamble <code>CUDA_VISIBLE_DEVICES=</code>, which effectively hides CUDA devices from the python process. The user only needs to specify <code>--start_seed</code> and <code>--num_maps</code>, which controlls the first attempted seed and the number of maps to generate, respectively.
                        </p>

                        <p>
                        Not every seed will lead to successful map generation. Terra Nova's map generation process follows a similar ruleset as the map generation process from LekMod, which leads to maps that are balanced in terms of resource and fertility distribution across the landmass. If a given seed will not produce a map that satisfices the balance constraints, the generation script will automatically move onto the next seed.
                        </p>

                    </section>

                        <section id="recording" class="section">
                        <h2>Recording Games</h2>
                        <p>
                        Terra Nova comes with utilities for recording games that your agents play.
                        See below for a short snippet on how to use the recorder.
                        For more detail, see the file <code class="code-inline">recording_demo.py</code>.
                        </p>

                        <p>
                        We highly recommend using a CPU-only job to perform game recording due to the memory usage of the recorder.
                        </p>

                        <pre class="code-block"><code class="language-python">from game.recorder import GameStateRecorder

...

# To initialize the recorder, we need to extract a single game from the bundle.
# This requires indexing within *both* the device and
# game axis => games[device_idx][games_idx]
# This exact process will need to be repeated after each player
# takes its step within each game turn.
gamestate = jax.tree_map(lambda x: x[args.device_idx][args.games_idx], games)
recorder = GameStateRecorder.create(reference_gamestate=gamestate, num_steps=args.num_steps)
recorder = recorder.record(gamestate)


for recording_int in range(args.num_steps):
    for agent_step in range(6):
        actions = ...
        (
          games,
          obs_spaces,
          episode_metrics,
          players_turn_id,
          obs,
          rewards,
          done_flags,
          executed_actions
        ) = env_step_fn(
            games, random_actions, obs_spaces, episode_metrics, players_turn_id
        )

    gamestate = jax.tree_map(lambda x: x[args.device_idx][args.games_idx], games)
    recorder = recorder.record(gamestate)

recorder.save_replay(f"./renderer/saved_games/{args.save_filename}")</code></pre>

                    </section>

                        <section id="viewer" class="section">
                        <h2>Viewing Games</h2>
                        <p>
                        After recording a game, we can view the replay using the Viewer. The Viewer leverages WebGL and your browser's hardware acceleration to render images to the screen. To run the viewer, open a terminal window and run the following command from within the Terra Nova folder:
                        </p>
                        <pre class="code-block"><code class="language-bash">bash ./run_viewer.sh</code></pre>

                        <p>
                        Then, the viewer can be opened in your preferred browser (we recommend Chrome) using the path printed to the terminal. The Viewer allows us to click through each turn in the replay while having full visibility into each agent's gamestate. The Viewer provides information on technologies, social policies, trade deals, victory progress, plots for various metrics, and more.
                        </p>


                    </section>

                </main>
            </div>
        </div>
    </div>

    <script>
        // Handle sidebar navigation active states
        document.addEventListener('DOMContentLoaded', function() {
            const sidebarLinks = document.querySelectorAll('.sidebar a');
            const sections = document.querySelectorAll('.section');

            // Function to update active link
            function updateActiveLink() {
                let currentSection = '';

                sections.forEach(section => {
                    const rect = section.getBoundingClientRect();
                    if (rect.top <= 100 && rect.bottom > 100) {
                        currentSection = section.id;
                    }
                });

                sidebarLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === '#' + currentSection) {
                        link.classList.add('active');
                    }
                });
            }

            // Update on scroll
            window.addEventListener('scroll', updateActiveLink);

            // Update on click
            sidebarLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const targetId = this.getAttribute('href').substring(1);
                    const targetSection = document.getElementById(targetId);

                    if (targetSection) {
                        targetSection.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                });
            });

            // Initial update
            updateActiveLink();
        });
    </script>
</body>
</html>
